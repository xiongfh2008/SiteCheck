---
import BaseLayout from '@layouts/Base.astro';
import NavBar from '@components/scafold/Nav.astro';
import HeroForm from '@components/homepage/HeroForm.astro';
import TempDisabled from '@/components/homepage/TempDisabled.astro';
import HomeBackground from '@/components/homepage/HomeBackground';
import AboutSection from '@/components/homepage/AboutSection.astro';
import Footer from '@components/scafold/Footer.astro';
import { t } from '@/lib/i18n-service';

const isBossServer = import.meta.env.BOSS_SERVER === true;

const disableEverything = import.meta.env.VITE_DISABLE_EVERYTHING === true;

// 获取当前语言，默认为英语
const url = new URL(Astro.request.url);
const currentLang = url.searchParams.get('lang') || 'en';

// Only redirect if there's a specific URL parameter, otherwise show the home page
const searchUrl = new URLSearchParams(new URL(Astro.request.url).search).get('url');
if (!isBossServer && searchUrl) {
  const redirectUrl = `/check/${encodeURIComponent(searchUrl)}?lang=${currentLang}`;
  return Astro.redirect(redirectUrl);
}

---

<BaseLayout title={`${t('home.title', currentLang)} | Website Check`} description={t('home.subtitle', currentLang)} lang={currentLang}>
  <div class="web-check-page">
    <NavBar currentLang={currentLang} />
    { disableEverything && <TempDisabled />}
    <main>
      <HeroForm lang={currentLang} />
      <AboutSection lang={currentLang} />
    </main>
    <Footer lang={currentLang} />
  </div>
  <HomeBackground client:only="react" />
</BaseLayout>

<style lang="scss">
  @import '@styles/global.scss';
  main {
    min-height: calc(100vh - 100px);
    padding: 2rem;
    margin: -50px auto 0 auto;  /* 上移 main 元素 */
    z-index: 3;
    background: var(--background);
    max-width: 1400px;
    width: 100%;
    
    @include tablet-landscape-down {
      width: 96vw;
      padding: 1rem;
      margin: -30px auto 0 auto;  /* 响应式上移 */
    }

    .screenshot {
      transform:
        rotate3d(.5,-.866,0,15deg)
        rotate(1deg);
      box-shadow:
        2em 4em 6em -2em rgba(0,0,0,.5),
        1em 2em 3.5em -2.5em rgba(0,0,0,.5);
      transition:
        transform .4s ease,
        box-shadow .4s ease;
      border-radius: .5em;

      &:hover {
        transform:
          rotate3d(0,0,0,0deg)
          rotate(0deg);
      }
    }
  }

</style>
