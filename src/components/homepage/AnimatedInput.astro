---
import { t } from '@/lib/i18n-service';

interface Props {
  lang?: string;
}

const { lang = 'en' } = Astro.props;

const placeholders = [
  t('home.examples_duck', lang) || 'duck.com',
  t('home.examples_google', lang) || 'google.com',
  t('home.examples_x', lang) || 'x.com',
  t('home.examples_bbc', lang) || 'bbc.co.uk',
  t('home.examples_wikipedia', lang) || 'wikipedia.org',
  t('home.examples_openai', lang) || 'openai.com',
];

const exampleText = t('home.examples', lang) || 'E.g.';
---


<div class="input-container">
  <input
    required
    id="url-input"
    type="url"
    name="url"
    placeholder={`${exampleText} ${placeholders[0]}`}
  />
  <div class="placeholder-container">
    <span class="starter" aria-hidden="true">{exampleText}</span>
    {placeholders.map((placeholder, index) => (
      <span class={`placeholder ${index === 0 ? 'active' : ''}`} aria-hidden="true">{placeholder}</span>
    ))}
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Grab the DOM elements we need
  const placeholders = document.querySelectorAll('.placeholder');
  const starter = document.querySelector('.starter');
  const inputField = document.getElementById('url-input');

  // Variables for the configuring + tracking the placeholder animation
  let currentIndex = 0;
  const timeBetweenPlaceholders = 3000;
  let interval;
  
  // Function to change which placeholder is currently visible
  const changePlaceholder = () => {
    placeholders.forEach((el, index) => {
      starter.classList.remove('hide');
      if (index === currentIndex) {
        el.classList.add('active');
        el.classList.remove('inactive');
        el.classList.remove('still-inactive');
      } else {
        el.classList.add('inactive');
        el.classList.remove('active');
        setTimeout(() => {
          el.classList.add('still-inactive');
        }, timeBetweenPlaceholders / 5);
      }
    });
    currentIndex = (currentIndex + 1) % placeholders.length;
  };

  // Begin the placeholder animation
  const startPlaceholderAnimation = () => {
    interval = setInterval(changePlaceholder, timeBetweenPlaceholders);
  };

  // Stop the placeholder animation
  const stopPlaceholderAnimation = () => {
    clearInterval(interval);
    starter.classList.add('hide');
    placeholders.forEach((el) => {
      el.classList.remove('active');
      el.classList.add('inactive');
    });
  };

  // When user focuses on the input field, stop the animation
  inputField.addEventListener('focus', () => {
    stopPlaceholderAnimation();
  });

  // And, when user un-focuses on input, resume the placeholder animation
  inputField.addEventListener('blur', () => {
    if (!inputField.value) {
      startPlaceholderAnimation();
    }
  });

  // If user types something, stop the animation
  inputField.addEventListener('input', () => {
    if (inputField.value) {
      stopPlaceholderAnimation();
    } else if (document.activeElement !== inputField) {
      startPlaceholderAnimation();
    }
  });

  // Disable the input's placeholder attribute
  inputField.setAttribute('placeholder', '');

  // Make visible the placeholder container
  const placeholderContainer = document.querySelector('.placeholder-container');
  if (placeholderContainer) {
    placeholderContainer.style.display = 'flex';
  }

  // And finally, start the animation!
  startPlaceholderAnimation();
});
</script>


<style lang="scss">
@import '@styles/typography.scss';
@import '@styles/global.scss';

.input-container {
  position: relative;
  overflow: hidden;
  width: 100%;
  input {
    width: 100%;
    padding: 1.2rem 1rem;
    background: var(--background-50);
    font-size: 1.5rem;
    color: var(--text-color-secondary);
    border: 2px solid var(--text-color-thirdly);
    border-radius: 8px;
    transition: all 0.3s ease-in-out;
    outline: none;
    /* 隐藏原生占位符以避免重影 */
    &::placeholder {
      color: transparent;
    }
    &:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-transparent);
    }
  }
}

.input-container .placeholder-container {
  display: none;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  align-items: center;
  padding-left: 16px;
  pointer-events: none;
  z-index: 1; /* 确保占位符文本在输入框之上 */
}

.starter, .placeholder {
  position: absolute;
  width: 100%;
  font-size: 1.5rem; /* 与输入框文字大小一致 */
  color: var(--text-color-thirdly);
  padding: 1.2rem 1rem; /* 与输入框内边距一致 */
  user-select: none;
  text-align: left; /* 确保文本左对齐 */
  line-height: 1.5; /* 确保垂直居中对齐 */
}

.starter {
  transition: opacity 0.6s, transform 0.5s;
  &.hide {
    opacity: 0;
    transform: translateX(-50%);
  }
}

.placeholder {
  padding-left: 4rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  transition: transform 0.5s ease-in-out, opacity 0.6s;
  opacity: 0;
  transform: translateY(-150%);
}

.placeholder.active {
  transform: translateY(0);
  opacity: 1;
}

.placeholder.inactive {
  transform: translateY(150%);
  opacity: 0;
}

.placeholder.still-inactive {
  transform: translateY(-150%);
  opacity: 0;
}


</style>
